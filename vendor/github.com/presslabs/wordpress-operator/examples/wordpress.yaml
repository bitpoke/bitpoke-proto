---
apiVersion: v1
kind: Secret
metadata:
  name: mysite-db
type: Opaque
data:
  ROOT_PASSWORD: bm90LXNvLXNlY3VyZQ==
  USER: d29yZHByZXNz
  PASSWORD: d3AtaW5zZWN1cmU=
  DATABASE: d29yZHByZXNz
---
apiVersion: v1
kind: Secret
metadata:
  name: mysite-salt
type: Opaque
data:
  AUTH_KEY: RU5UOEBLUENENlNKJzkpaE1TKSx4V0tQSShvYENDbW5ZVkZoQEt9TE5TLzIwOjhPZGY5JSc2YTReY3p4a1g0LQ==
  SECURE_AUTH_KEY: MXJRLlZZQUtdcyk7KX5bKnskeixBe20uN3ZeXzFCby5TbU1Jdkh1VSFGSn10bjNwUWYmUmBdcylbMk9Tajp2LQ==
  LOGGED_IN_KEY: Sm4xdmVGSV0zP0pmPVUsN3llX1lacChvP2M3YWtlYiVEX3JZbk4jKEo+QGVAL1ZUdHd5aVlKbEBWaT1zcj11PQ==
  NONCE_KEY: Jm9eTn1oNTRKLn5pOTlbWHpqQ3tNJG53YVgneEFGPW1PPiYwdSRDVTFPLlB1RVc1NVZtcmRPfWMoYG43QmNNdg==
  AUTH_SALT: RnorP35BZFB3d3IwfVNsWnYsL0szZiE3Xj0tV2NQY20wc1IxZFpob2dfNnFqXn1tLjpDUmQzXV5XZCh3W1ApPw==
  SECURE_AUTH_SALT: QllpZVlrfkExRzFnWlpMUDI/aXJieyVifW0yP2BUP3Z0ZHwwJCFNS0klbEUsNGBUbWhjeE4sNVNge2Mzbzt5IQ==
  LOGGED_IN_SALT: QHNeZSJaSTU0PnNWKS9QOjxmWConIVRhMmwuWFpHO2QxV0xxQzBdY0NeTjFpNiU+PCEnYEA1ZT5KSy5oanl4Ug==
  NONCE_SALT: OCclcHg7UTIzZXdkVi9PJCsoVWZTWkUuTUwnZ2N3IzFPfGpZRWBAaD5VMTtbdnIzWHtSdnt4ZUVWcGtETnhzUQ==
---
apiVersion: mysql.presslabs.org/v1alpha1
kind: MysqlCluster
metadata:
  name: mysite
spec:
  replicas: 1
  secretName: mysite-db
---
apiVersion: wordpress.presslabs.org/v1alpha1
kind: Wordpress
metadata:
  name: mysite
spec:
  replicas: 3
  secretRef: mysite
  tlsSecretRef: mysite-tls
  contentVolumeSpec:
    hostPath:
      path: "/Users/calin/work/src/github.com/presslabs/wordpress-operator/content"
      type: "DirectoryOrCreate"
  envFrom:
    - prefix: "WORDPRESS_"
      secretRef:
        name: mysite-salt
  env:
    - name: WORDPRESS_DB_HOST
      value: mysite-mysql-master
    - name: WORDPRESS_DB_USER
      valueFrom:
        secretKeyRef:
          name: mysite-db
          key: USER
    - name: WORDPRESS_DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: mysite-db
          key: PASSWORD
    - name: WORDPRESS_DB_NAME
      valueFrom:
        secretKeyRef:
          name: mysite-db
          key: DATABASE
  domains:
    - calin.localtest.me
  # webPodTemplate:
  #   spec:
  #     containers:
  #       - name: wordpress
  #         image: wordpress:4.9.7-php7.2
  #         ports:
  #           - name: http
  #             containerPort: 80
  # cliPodTemplate:
  #   spec:
  #     containers:
  #       - name: wordpress
  #         image: wordpress:cli-php7.2
# ---
# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: nginx-conf
# data:
#   default.conf: |
#     upstream php {
#       server 127.0.0.1:9000;
#     }
#     server {
#         listen       80;
#         server_name  _ default_server;

#         root  /var/www/html;
#         index index.html index.htm index.php;

#         # Global restrictions configuration file.
#         # Designed to be included in any server {} block.
#         location = /favicon.ico {
#           log_not_found off;
#           access_log off;
#         }

#         location = /robots.txt {
#           allow all;
#           log_not_found off;
#           access_log off;
#         }

#         # Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).
#         # Keep logging the requests to parse later (or to pass to firewall utilities such as fail2ban)
#         location ~ /\. {
#           deny all;
#         }

#         # Deny access to any files with a .php extension in the uploads directory
#         # Works in sub-directory installs and also in multisite network
#         # Keep logging the requests to parse later (or to pass to firewall utilities such as fail2ban)
#         location ~* /(?:uploads|files)/.*\.php$ {
#           deny all;
#         }

#         location / {
#           # This is cool because no php is touched for static content.
#           # include the "?$args" part so non-default permalinks doesn't break when using query string
#           try_files $uri $uri/ /index.php?$args;
#         }

#         location ~ \.php$ {
#           #NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
#           include fastcgi_params;
#           fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#           fastcgi_intercept_errors on;
#           fastcgi_pass php;
#           fastcgi_buffers 16 16k;
#           fastcgi_buffer_size 32k;
#         }

#         location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
#           expires max;
#           log_not_found off;
#         }
#     }

