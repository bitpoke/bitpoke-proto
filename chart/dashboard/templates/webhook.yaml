# Code generated by Makefile. DO NOT EDIT.
{{ $domain := printf "%s-webhook.%s.svc" (include "dashboard.name" .) .Release.Namespace }}
{{ $cert := genSelfSignedCert $domain nil nil 365 }}

apiVersion: v1
data:
  ca-cert.pem: '{{ $cert.Cert | b64enc }}'
  ca-key.pem: '{{ $cert.Key | b64enc }}'
  cert.pem: '{{ $cert.Cert | b64enc }}'
  key.pem: '{{ $cert.Key | b64enc }}'
kind: Secret
metadata:
  annotations:
    helm.sh/hook: pre-install
    helm.sh/hook-delete-policy: before-hook-creation
  labels:
    app: '{{ include "dashboard.name" . }}'
    chart: '{{ include "dashboard.chart" . }}'
    heritage: '{{ .Release.Service }}'
    release: '{{ .Release.Name }}'
  name: '{{ include "dashboard.webhook.secretName" . }}'
  namespace: '{{ .Release.Namespace }}'
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: '{{ include "dashboard.name" . }}'
    chart: '{{ include "dashboard.chart" . }}'
    heritage: '{{ .Release.Service }}'
    release: '{{ .Release.Name }}'
  name: '{{ include "dashboard.fullname" . }}-webhook'
  namespace: '{{ .Release.Namespace }}'
spec:
  ports:
  - name: http
    port: {{ .Values.webhook.service.port }}
    protocol: TCP
    targetPort: {{ .Values.webhook.service.targetPort }}
  selector:
    app: '{{ include "dashboard.name" . }}'
    release: '{{ .Release.Name }}'
  type: '{{ .Values.webhook.service.type }}'
status:
  loadBalancer: {}
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  labels:
    app: '{{ include "dashboard.name" . }}'
    chart: '{{ include "dashboard.chart" . }}'
    heritage: '{{ .Release.Service }}'
    release: '{{ .Release.Name }}'
  name: validating-webhook-configuration
webhooks:
- clientConfig:
    caBundle: '{{ $cert.Cert | b64enc }}'
    service:
      name: '{{ include "dashboard.fullname" . }}-webhook'
      namespace: '{{ .Release.Namespace }}'
      path: /validating-create-organization
  failurePolicy: Fail
  name: validating-create-organization.presslabs.com
  rules:
  - apiGroups:
    - ''
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - namespaces
- clientConfig:
    caBundle: '{{ $cert.Cert | b64enc }}'
    service:
      name: '{{ include "dashboard.fullname" . }}-webhook'
      namespace: '{{ .Release.Namespace }}'
      path: /validating-create-project
  failurePolicy: Fail
  name: validating-create-project.presslabs.com
  rules:
  - apiGroups:
    - wordpress.presslabs.org
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    resources:
    - wordpresses
- clientConfig:
    caBundle: '{{ $cert.Cert | b64enc }}'
    service:
      name: '{{ include "dashboard.fullname" . }}-webhook'
      namespace: '{{ .Release.Namespace }}'
      path: /validating-create-site
  failurePolicy: Fail
  name: validating-create-site.presslabs.com
  rules:
  - apiGroups:
    - ''
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - namespaces
